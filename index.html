<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Department Budget Tracker 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
        height: 300px;
        max-height: 350px;
      }
      @media (min-width: 768px) {
        .chart-container {
          height: 350px;
          max-height: 400px;
        }
      }
      
      /* Hide arrows/spinners for number inputs */
      input[type="number"] {
        -moz-appearance: textfield;
      }
      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Base style for editable inputs in the table */
      .table-input {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem; /* sm:text-sm */
        line-height: 1.25rem;
        border-color: #e5e5e5; /* stone-300 */
        border-radius: 0.375rem; /* rounded-md */
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        transition: all 0.15s ease-in-out;
      }
      .table-input:focus {
        border-color: #10b981; /* emerald-500 */
        box-shadow: 0 0 0 1px #10b981, 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        outline: 2px solid transparent;
        outline-offset: 2px;
      }

      /* Specific widths for input types */
      .input-text-sm {
        width: 100%;
        max-width: 100px; /* Max width for smaller text fields */
      }
      .input-text-lg {
        width: 100%;
        max-width: 250px; /* Max width for larger text fields like notes */
      }
      .input-currency {
        width: 100%;
        max-width: 100px; /* Max width for currency fields */
        text-align: right;
      }
    </style>
</head>
<body class="bg-stone-50 text-zinc-800">

  <div class="container mx-auto p-4 sm:p-6 lg:p-10">
    
    <header class="mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-zinc-900">IT Department Budget Tracker</h1>
      <p class="text-lg text-zinc-600">Fiscal Year 2026</p>
    </header>

    <section id="summary-kpis" class="mb-10">
      <h2 class="text-2xl font-semibold text-zinc-900 mb-4">Overall Budget Health</h2>
      <p class="text-zinc-600 mb-5 max-w-3xl">
        This section provides a live overview of the entire IT budget. The "Total Actual Spend" and "Total Variance"
        will update automatically as you enter spending data in the detail table below.
      </p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6">
        <div class="bg-white p-5 rounded-lg shadow border border-stone-200">
          <h3 class="text-sm font-medium text-zinc-500 uppercase tracking-wide">Total Projected Budget</h3>
          <p id="total-budget" class="text-3xl font-bold text-zinc-900 mt-2">$0.00</p>
        </div>
        <div class="bg-white p-5 rounded-lg shadow border border-stone-200">
          <h3 class="text-sm font-medium text-zinc-500 uppercase tracking-wide">Total Actual Spend</h3>
          <p id="total-actual" class="text-3xl font-bold text-emerald-600 mt-2">$0.00</p>
        </div>
        <div class="bg-white p-5 rounded-lg shadow border border-stone-200">
          <h3 class="text-sm font-medium text-zinc-500 uppercase tracking-wide">Total Variance (Remaining)</h3>
          <p id="total-variance" class="text-3xl font-bold text-zinc-900 mt-2">$0.00</p>
          <p id="variance-subtitle" class="text-sm text-zinc-500"></p>
        </div>
      </div>
    </section>

    <section id="visual-summary" class="mb-10">
        <h2 class="text-2xl font-semibold text-zinc-900 mb-4">Visual Summary</h2>
        <p class="text-zinc-600 mb-5 max-w-3xl">
          These charts illustrate the planned budget allocation. The donut chart shows how the total budget is divided among the main categories.
          The bar chart shows the planned spending cadence by quarter, which you can filter by category in the "Budget Detail" section below.
        </p>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white p-5 rounded-lg shadow border border-stone-200">
                <h3 class="text-lg font-semibold text-center mb-4">Projected Budget by Category</h3>
                <div class="chart-container">
                    <canvas id="categoryDonutChart"></canvas>
                </div>
            </div>
            <div class="bg-white p-5 rounded-lg shadow border border-stone-200">
                <h3 id="quarterly-chart-title" class="text-lg font-semibold text-center mb-4">Projected Quarterly Spend (All Categories)</h3>
                 <div class="chart-container">
                    <canvas id="quarterlyBarChart"></canvas>
                </div>
            </div>
        </div>
    </section>

    <section id="budget-detail">
      <h2 class="text-2xl font-semibold text-zinc-900 mb-4">Budget Detail & Tracker (All Fields Editable)</h2>
      <p class="text-zinc-600 mb-5 max-w-3xl">
        All fields in the table below are now editable. Changing **Projected Annual** or **Actual YTD Spend** will automatically recalculate the **Variance** and update the Global KPIs and Charts.
      </p>

      <div class="mb-5">
        <label for="category-filter" class="block text-sm font-medium text-zinc-700 mb-2">Filter by Category</label>
        <select id="category-filter" class="w-full max-w-xs rounded-md border-stone-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500">
          <option value="All">All Categories</option>
        </select>
      </div>

      <div class="bg-white rounded-lg shadow border border-stone-200 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-stone-200">
            <thead class="bg-stone-100">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider min-w-[150px]">Category</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider min-w-[200px]">Item/Description</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider min-w-[150px]">Projected Annual</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider min-w-[150px]">Actual YTD Spend</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider min-w-[120px]">Variance</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-zinc-500 uppercase tracking-wider min-w-[250px]">Notes</th>
              </tr>
            </thead>
            <tbody id="budget-table-body" class="bg-white divide-y divide-stone-200">
              </tbody>
          </table>
        </div>
      </div>
    </section>

  </div>

  <script>
    // Global data structure
    let budgetData = [
      { id: 1, category: "1. Personnel", subcategory: "Salaries", item: "Full-Time Staff (FTEs)", q1: 200000, q2: 200000, q3: 200000, q4: 200000, projected: 800000, actual: 0, notes: "5 Core Engineers, 1 Manager" },
      { id: 2, category: "1. Personnel", subcategory: "Salaries", item: "Benefits and Taxes", q1: 45000, q2: 45000, q3: 45000, q4: 45000, projected: 180000, actual: 0, notes: "Estimate 22.5% of Salaries" },
      { id: 3, category: "1. Personnel", subcategory: "Contractors", item: "Specialized External Resources", q1: 15000, q2: 15000, q3: 15000, q4: 15000, projected: 60000, actual: 0, notes: "External audit and project support" },
      { id: 4, category: "2. Hardware & Infrastructure", subcategory: "Endpoint Devices", item: "Desktop/Laptop Refresh Program", q1: 60000, q2: 20000, q3: 10000, q4: 10000, projected: 100000, actual: 0, notes: "Bulk purchase Q1 (30 units)" },
      { id: 5, category: "2. Hardware & Infrastructure", subcategory: "Cloud", item: "Google Cloud Platform (GCP)", q1: 40000, q2: 42000, q3: 44000, q4: 46000, projected: 172000, actual: 0, notes: "Anticipated 5% growth per quarter" },
      { id: 6, category: "2. Hardware & Infrastructure", subcategory: "Networking", item: "Firewall/Router replacement", q1: 5000, q2: 0, q3: 15000, q4: 0, projected: 20000, actual: 0, notes: "Major upgrade planned in Q3" },
      { id: 7, category: "3. Software & Subscriptions", subcategory: "Annual Licensing", item: "Enterprise productivity suite", q1: 95000, q2: 0, q3: 0, q4: 0, projected: 95000, actual: 0, notes: "Paid annually in January" },
      { id: 8, category: "3. Software & Subscriptions", subcategory: "SaaS Tools", item: "Security & Monitoring (e.g., SIEM)", q1: 8000, q2: 8000, q3: 8000, q4: 8000, projected: 32000, actual: 0, notes: "$2,667/month subscription" },
      { id: 9, category: "3. Software & Subscriptions", subcategory: "Dev Tools", item: "Coding/Testing Subscriptions", q1: 2500, q2: 2500, q3: 2500, q4: 2500, projected: 10000, actual: 0, notes: "Developer seats and licenses" },
      { id: 10, category: "4. Training & Development", subcategory: "Certifications", item: "Technical Training Courses", q1: 4000, q2: 0, q3: 6000, q4: 0, projected: 10000, actual: 0, notes: "Team training events (Q1 & Q3)" },
      { id: 11, category: "4. Training & Development", subcategory: "Travel", item: "Conferences and Seminars", q1: 1500, q2: 3500, q3: 0, q4: 2000, projected: 7000, actual: 0, notes: "Attending major industry conference in Q2" },
      { id: 12, category: "5. Operational Expenses", subcategory: "Office/Utility", item: "Server Room Power/Cooling", q1: 4000, q2: 4000, q3: 4000, q4: 4000, projected: 16000, actual: 0, notes: "Estimate for data center operations" },
      { id: 13, category: "5. Operational Expenses", subcategory: "Consumables", item: "Backup Media, Printer Supplies", q1: 500, q2: 500, q3: 500, q4: 500, projected: 2000, actual: 0, notes: "Misc. supplies" }
    ];

    let categories = [...new Set(budgetData.map(item => item.category))];
    
    let categoryDonutChart;
    let quarterlyBarChart;

    const formatCurrency = (value) => {
      // Ensure the value is a number and not null/undefined for formatting
      const numberValue = parseFloat(value) || 0;
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
      }).format(numberValue);
    };
    
    const formatLabel = (str, maxLen) => {
      if (str.length <= maxLen) return str;
      const words = str.split(' ');
      let currentLine = '';
      const lines = [];
      for (const word of words) {
        if ((currentLine + ' ' + word).length > maxLen && currentLine.length > 0) {
          lines.push(currentLine.trim());
          currentLine = word;
        } else {
          currentLine += (currentLine.length === 0 ? '' : ' ') + word;
        }
      }
      lines.push(currentLine.trim());
      return lines;
    };

    const getCategoryTotals = () => {
      const totals = {};
      // Recalculate categories array based on current data
      const currentCategories = [...new Set(budgetData.map(item => item.category))];
      
      currentCategories.forEach(category => {
        totals[category] = budgetData
          .filter(item => item.category === category)
          .reduce((sum, item) => sum + (parseFloat(item.projected) || 0), 0);
      });
      return totals;
    };

    const getQuarterlyTotals = (filter = "All") => {
      const filteredData = filter === "All"
        ? budgetData
        : budgetData.filter(item => item.category === filter);
        
      return {
        q1: filteredData.reduce((sum, item) => sum + (parseFloat(item.q1) || 0), 0),
        q2: filteredData.reduce((sum, item) => sum + (parseFloat(item.q2) || 0), 0),
        q3: filteredData.reduce((sum, item) => sum + (parseFloat(item.q3) || 0), 0),
        q4: filteredData.reduce((sum, item) => sum + (parseFloat(item.q4) || 0), 0),
      };
    };

    const updateCalculatedFields = (itemId) => {
        const item = budgetData.find(d => d.id === itemId);
        
        // Ensure values are numbers before calculation
        const projected = parseFloat(item.projected) || 0;
        const actual = parseFloat(item.actual) || 0;
        
        const newVariance = projected - actual;
        
        // Update the variance cell in the table
        const varianceCell = document.querySelector(`#row-${item.id} .variance-cell`);
        if (varianceCell) {
            varianceCell.textContent = formatCurrency(newVariance);
            if (newVariance < 0) {
                varianceCell.classList.remove('text-zinc-900');
                varianceCell.classList.add('text-red-600');
            } else {
                varianceCell.classList.remove('text-red-600');
                varianceCell.classList.add('text-zinc-900');
            }
        }
        
        updateGlobalKPIs();
        updateCharts();
    }
    
    // Global edit handler for all editable fields (text, number/currency)
    const handleEdit = (event) => {
        const itemId = parseInt(event.target.dataset.id, 10);
        const field = event.target.dataset.field;
        let value = event.target.value;

        const item = budgetData.find(d => d.id === itemId);

        if (field === 'projected' || field === 'actual') {
            // Convert to number for financial fields. Null if invalid/empty
            value = parseFloat(value) || 0;
            // Also need to recalculate Q totals if 'projected' changes.
            // For simplicity, we assume projected total change doesn't update Q breakdown here.
        } 
        
        // Update the item in the data array
        item[field] = value;

        // Recalculate variance and update KPIs/Charts
        updateCalculatedFields(itemId);
        
        // If Category changed, need to re-render the filter dropdown and current filter status
        if (field === 'category') {
            updateCategoryFilterDropdown();
            // Re-render table and charts based on current filter to ensure new category is displayed correctly
            const currentFilter = document.getElementById('category-filter').value;
            renderTable(currentFilter);
            updateQuarterlyBarChart(currentFilter);
        }
    };
    // Expose handleEdit to the global scope for use in oninput/onchange attributes
    window.handleEdit = handleEdit;


    const renderTable = (filter = "All") => {
      const tableBody = document.getElementById('budget-table-body');
      tableBody.innerHTML = '';
      
      const filteredData = filter === "All"
        ? budgetData
        : budgetData.filter(item => item.category === filter);

      if (filteredData.length === 0) {
          tableBody.innerHTML = `<tr><td colspan="6" class="text-center px-6 py-4 text-zinc-500">No data found for this category.</td></tr>`;
          return;
      }

      filteredData.forEach(item => {
        const projected = parseFloat(item.projected) || 0;
        const actual = parseFloat(item.actual) || 0;
        const variance = projected - actual;
        const varianceColor = variance < 0 ? 'text-red-600' : 'text-zinc-900';
        
        // Using 'onchange' for text/number fields to only fire when user tabs out or presses enter, 
        // to prevent over-calculating on every keystroke for non-critical fields.
        // 'oninput' is only kept for 'Actual YTD Spend' for real-time variance update (via handleEdit).
        
        const row = `
          <tr id="row-${item.id}" class="hover:bg-stone-50 transition-colors">
            <td class="px-6 py-2 whitespace-nowrap text-sm text-zinc-600">
                <input
                    type="text"
                    data-id="${item.id}"
                    data-field="category"
                    value="${item.category}"
                    class="table-input input-text-sm"
                    onchange="handleEdit(event)"
                >
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-sm font-medium text-zinc-900">
                <input
                    type="text"
                    data-id="${item.id}"
                    data-field="item"
                    value="${item.item}"
                    class="table-input w-full"
                    onchange="handleEdit(event)"
                >
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-sm text-zinc-600">
                <input
                    type="number"
                    data-id="${item.id}"
                    data-field="projected"
                    value="${item.projected}"
                    placeholder="0"
                    min="0"
                    class="table-input input-currency"
                    onchange="handleEdit(event)"
                >
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-sm">
                <input 
                    type="number" 
                    data-id="${item.id}"
                    data-field="actual"
                    value="${item.actual === 0 ? '' : item.actual}"
                    placeholder="0"
                    min="0"
                    class="table-input input-currency text-emerald-600 font-medium"
                    oninput="handleEdit(event)" 
                >
            </td>
            <td class="variance-cell px-6 py-4 whitespace-nowrap text-sm font-medium ${varianceColor}">
                ${formatCurrency(variance)}
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-sm text-zinc-500">
                <input
                    type="text"
                    data-id="${item.id}"
                    data-field="notes"
                    value="${item.notes}"
                    class="table-input input-text-lg"
                    onchange="handleEdit(event)"
                >
            </td>
          </tr>
        `;
        tableBody.innerHTML += row;
      });
    };
    
    // Simplified function to update the global KPIs (used by all edit handlers)
    const updateGlobalKPIs = () => {
      const totalProjected = budgetData.reduce((sum, item) => sum + (parseFloat(item.projected) || 0), 0);
      const totalActual = budgetData.reduce((sum, item) => sum + (parseFloat(item.actual) || 0), 0);
      const totalVariance = totalProjected - totalActual;
      
      document.getElementById('total-budget').textContent = formatCurrency(totalProjected);
      document.getElementById('total-actual').textContent = formatCurrency(totalActual);
      document.getElementById('total-variance').textContent = formatCurrency(totalVariance);
      
      const varianceSubtitle = document.getElementById('variance-subtitle');
      const varianceElement = document.getElementById('total-variance');
      
      if (totalVariance < 0) {
        varianceElement.classList.add('text-red-600');
        varianceElement.classList.remove('text-zinc-900');
        varianceSubtitle.textContent = `Over budget by ${formatCurrency(Math.abs(totalVariance))}`;
      } else {
        varianceElement.classList.remove('text-red-600');
        varianceElement.classList.add('text-zinc-900');
        varianceSubtitle.textContent = `Under budget`;
      }
    };

    // Consolidated chart update logic
    const updateCharts = () => {
        if (categoryDonutChart) {
            const categoryTotals = getCategoryTotals();
            categoryDonutChart.data.labels = Object.keys(categoryTotals);
            categoryDonutChart.data.datasets[0].data = Object.values(categoryTotals);
            categoryDonutChart.update();
        }
        
        // Use the current filter to update the bar chart
        const currentFilter = document.getElementById('category-filter').value;
        updateQuarterlyBarChart(currentFilter);
    }
    
    const updateCategoryFilterDropdown = () => {
        // 1. Recalculate categories array from current data
        categories = [...new Set(budgetData.map(item => item.category))];
        
        // 2. Preserve current selected value
        const filterSelect = document.getElementById('category-filter');
        const currentValue = filterSelect.value;
        
        // 3. Clear and re-populate dropdown
        filterSelect.innerHTML = '<option value="All">All Categories</option>';
        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            filterSelect.appendChild(option);
        });
        
        // 4. Restore selected value if it still exists, otherwise default to 'All'
        if (categories.includes(currentValue)) {
            filterSelect.value = currentValue;
        } else {
            filterSelect.value = 'All';
        }
    }
    
    const setupFilters = () => {
      updateCategoryFilterDropdown(); // Initial setup

      const filterSelect = document.getElementById('category-filter');
      filterSelect.addEventListener('change', (event) => {
        const selectedCategory = event.target.value;
        renderTable(selectedCategory);
        updateQuarterlyBarChart(selectedCategory);
      });
    };

    const createCategoryDonutChart = () => {
      const ctx = document.getElementById('categoryDonutChart').getContext('2d');
      const categoryTotals = getCategoryTotals();
      
      categoryDonutChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(categoryTotals),
          datasets: [{
            label: 'Projected Budget',
            data: Object.values(categoryTotals),
            backgroundColor: [
              '#10b981', // emerald-500
              '#3b82f6', // blue-500
              '#f97316', // orange-500
              '#8b5cf6', // violet-500
              '#ec4899', // pink-500
            ],
            borderColor: '#ffffff',
            borderWidth: 2,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                 padding: 15,
                 font: {
                   size: 11,
                 }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.label || '';
                  if (label) {
                    label += ': ';
                  }
                  if (context.parsed !== null) {
                    // Use standard number formatter for currency in tooltip
                    const currencyValue = new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0,
                    }).format(context.parsed);
                    label += currencyValue;
                  }
                  return formatLabel(label, 25);
                }
              }
            }
          }
        }
      });
    };
    
    const createQuarterlyBarChart = () => {
        const ctx = document.getElementById('quarterlyBarChart').getContext('2d');
        const quarterlyTotals = getQuarterlyTotals("All");
        
        quarterlyBarChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                datasets: [{
                    label: 'Projected Quarterly Budget',
                    data: Object.values(quarterlyTotals),
                    backgroundColor: '#10b981', // emerald-500
                    borderRadius: 4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.dataset.label}: ${formatCurrency(context.parsed.y)}`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: (value) => formatCurrency(value)
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    };
    
    const updateQuarterlyBarChart = (filter = "All") => {
        const quarterlyTotals = getQuarterlyTotals(filter);
        if (quarterlyBarChart) {
            quarterlyBarChart.data.datasets[0].data = Object.values(quarterlyTotals);
            quarterlyBarChart.update();
        }
        
        const title = filter === "All" ? "Projected Quarterly Spend (All Categories)" : `Projected Quarterly Spend (${filter})`;
        document.getElementById('quarterly-chart-title').textContent = title;
    };

    window.addEventListener('DOMContentLoaded', () => {
      setupFilters();
      renderTable();
      updateGlobalKPIs();
      createCategoryDonutChart();
      createQuarterlyBarChart();
    });

  </script>
</body>
</html>
